(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var UserListDisplay = function (_React$Component) {
  _inherits(UserListDisplay, _React$Component);

  function UserListDisplay(props) {
    _classCallCheck(this, UserListDisplay);

    return _possibleConstructorReturn(this, (UserListDisplay.__proto__ || Object.getPrototypeOf(UserListDisplay)).call(this, props));
  }

  _createClass(UserListDisplay, [{
    key: 'render',
    value: function render() {
      var userRows = [],
          curUser = this.props.userData.curUserName;

      var users = this.props.userData.list.filter(function (user) {
        return user !== curUser;
      });
      users.forEach(function (user) {
        userRows.push(React.createElement(
          'li',
          null,
          user
        ));
      });
      return React.createElement(
        'div',
        { className: 'user-list-info' },
        this.props.userData.list.length > 0 && React.createElement(
          'div',
          null,
          React.createElement(
            'p',
            null,
            'Welcome ',
            this.props.userData.curUserName
          ),
          React.createElement(
            'p',
            null,
            'Other Users Online (',
            users.length,
            ' online)'
          )
        ),
        React.createElement(
          'ul',
          null,
          userRows
        )
      );
    }
  }]);

  return UserListDisplay;
}(React.Component);

;

var MessageRow = function (_React$Component2) {
  _inherits(MessageRow, _React$Component2);

  function MessageRow(props) {
    _classCallCheck(this, MessageRow);

    return _possibleConstructorReturn(this, (MessageRow.__proto__ || Object.getPrototypeOf(MessageRow)).call(this, props));
  }

  _createClass(MessageRow, [{
    key: 'render',
    value: function render() {
      var msg = this.props.messageData;
      var divClasses = msg.isMe ? 'row message self' : 'row message';
      return React.createElement(
        'div',
        { className: divClasses },
        React.createElement(
          'p',
          { className: 'message-info' },
          React.createElement(
            'span',
            { className: 'user' },
            msg.name,
            ', '
          ),
          React.createElement(
            'time',
            { className: 'date', title: msg.date },
            msg.date
          )
        ),
        React.createElement(
          'p',
          { className: 'message-text' },
          msg.message
        )
      );
    }
  }]);

  return MessageRow;
}(React.Component);

;

var MessageForm = function (_React$Component3) {
  _inherits(MessageForm, _React$Component3);

  function MessageForm(props) {
    _classCallCheck(this, MessageForm);

    var _this3 = _possibleConstructorReturn(this, (MessageForm.__proto__ || Object.getPrototypeOf(MessageForm)).call(this, props));

    _this3.handleChange = _this3.handleChange.bind(_this3);
    _this3.handleSubmit = _this3.handleSubmit.bind(_this3);

    _this3.state = {
      message: ''
    };
    return _this3;
  }

  _createClass(MessageForm, [{
    key: 'handleChange',
    value: function handleChange(e) {
      var newState = {};
      newState[e.target.name] = e.target.value;
      this.setState(newState);
    }
  }, {
    key: 'handleSubmit',
    value: function handleSubmit(e) {
      e.preventDefault();

      var self = this;
      app.sendMessage(this.state.message, function (success) {
        if (success) {
          self.props.addMessage({
            message: self.state.message,
            name: 'Me',
            date: new Date().toISOString(),
            isMe: true
          });
          self.setState({ message: '' });
        }
      });
    }
  }, {
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'message-form-div' },
        React.createElement(
          'form',
          { onSubmit: this.handleSubmit, novalidate: true },
          React.createElement(
            'div',
            { className: 'input-group' },
            React.createElement('input', _defineProperty({ name: 'message', type: 'text', className: 'form-control',
              placeholder: 'Enter a message',
              onChange: this.handleChange, value: this.state.message
            }, 'value', this.state.message)),
            React.createElement(
              'span',
              { className: 'input-group-btn' },
              React.createElement(
                'button',
                { className: 'btn btn-success', type: 'submit', disabled: !this.state.message },
                'Send'
              )
            )
          )
        )
      );
    }
  }]);

  return MessageForm;
}(React.Component);

var ChatSection = function (_React$Component4) {
  _inherits(ChatSection, _React$Component4);

  function ChatSection(props) {
    _classCallCheck(this, ChatSection);

    var _this4 = _possibleConstructorReturn(this, (ChatSection.__proto__ || Object.getPrototypeOf(ChatSection)).call(this, props));

    _this4.addMessage = _this4.addMessage.bind(_this4);

    _this4.state = {
      messages: [],
      userListData: {
        curUserName: '', // Name of this current user
        list: []
      }
    };

    return _this4;
  }

  // Subscribe for pubsub from main app. External messages are subscribed to here
  // Pubsub w/ react and pubsub-js
  //   See: https://anthonymineo.com/communication-between-independent-components-in-react-using-pubsubjs/


  _createClass(ChatSection, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      this.messageToken = PubSub.subscribe('NewMessage', this.externalMessage.bind(this));
      this.userDataToke = PubSub.subscribe('UserListData', this.userDataUpdate.bind(this));
    }
    //componentDidMount() {}

  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      PubSub.unsubscribe(this.messageToken);
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      // Wire up jquery.timeago plugin to chat timestamps after render
      $('time').each(function () {
        $(this).text($.timeago($(this).attr('title')));
      });

      // Publish a message that the chat box has been rendered
      PubSub.publish('ChatBoxRendered', {});
    }

    // External messages recieved here

  }, {
    key: 'externalMessage',
    value: function externalMessage(msg, data) {
      console.log('pubsub-> ' + msg + JSON.stringify(data));
      this.addMessage(data);
    }

    // External pubsub user data update recieved here

  }, {
    key: 'userDataUpdate',
    value: function userDataUpdate(msg, data) {
      console.log('pubsub-> ' + msg + JSON.stringify(data));
      this.setState({
        userListData: {
          curUserName: data.curUserName,
          list: data.list
        }
      });
    }
  }, {
    key: 'addMessage',
    value: function addMessage(data) {
      var newMessages = this.state.messages.map(function (msg) {
        return msg;
      });
      newMessages.push(data);
      this.setState({ messages: newMessages });
      console.log('addMessage');
    }
  }, {
    key: 'render',
    value: function render() {

      var messageRows = [];
      this.state.messages.forEach(function (msg) {
        messageRows.push(React.createElement(MessageRow, { messageData: msg }));
      });

      return React.createElement(
        'div',
        { className: 'col-lg-12' },
        React.createElement(
          'div',
          { id: 'chat-box' },
          messageRows
        ),
        React.createElement(MessageForm, { addMessage: this.addMessage }),
        React.createElement(UserListDisplay, { userData: this.state.userListData })
      );
    }
  }]);

  return ChatSection;
}(React.Component);

;

ReactDOM.render(React.createElement(ChatSection, null), document.querySelector('#chat-section'));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjbGllbnRcXGpzeFxcY2hhdC1zZWN0aW9uLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztJQ0NNLGU7OztBQUNKLDJCQUFZLEtBQVosRUFBbUI7QUFBQTs7QUFBQSw2SEFDWCxLQURXO0FBRWxCOzs7OzZCQUVRO0FBQ1IsVUFBSSxXQUFXLEVBQWY7QUFBQSxVQUNFLFVBQVUsS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFvQixXQURoQzs7QUFHQSxVQUFJLFFBQVEsS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFvQixJQUFwQixDQUF5QixNQUF6QixDQUFnQyxVQUFTLElBQVQsRUFBZTtBQUFFLGVBQU8sU0FBUyxPQUFoQjtBQUEwQixPQUEzRSxDQUFaO0FBQ0EsWUFBTSxPQUFOLENBQWMsVUFBQyxJQUFELEVBQVU7QUFDdkIsaUJBQVMsSUFBVCxDQUFjO0FBQUE7QUFBQTtBQUFLO0FBQUwsU0FBZDtBQUNBLE9BRkQ7QUFHQSxhQUNDO0FBQUE7QUFBQSxVQUFLLFdBQVUsZ0JBQWY7QUFDRyxhQUFLLEtBQUwsQ0FBVyxRQUFYLENBQW9CLElBQXBCLENBQXlCLE1BQXpCLEdBQWtDLENBQWxDLElBQ0Y7QUFBQTtBQUFBO0FBQ0M7QUFBQTtBQUFBO0FBQUE7QUFBWSxpQkFBSyxLQUFMLENBQVcsUUFBWCxDQUFvQjtBQUFoQyxXQUREO0FBRUM7QUFBQTtBQUFBO0FBQUE7QUFBd0Isa0JBQU0sTUFBOUI7QUFBQTtBQUFBO0FBRkQsU0FGRDtBQU9DO0FBQUE7QUFBQTtBQUNFO0FBREY7QUFQRCxPQUREO0FBYUE7Ozs7RUExQjJCLE1BQU0sUzs7QUEyQm5DOztJQUdLLFU7OztBQUNKLHNCQUFZLEtBQVosRUFBbUI7QUFBQTs7QUFBQSxtSEFDWCxLQURXO0FBRWxCOzs7OzZCQUVRO0FBQ1IsVUFBSSxNQUFNLEtBQUssS0FBTCxDQUFXLFdBQXJCO0FBQ0EsVUFBSSxhQUFh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SyxLQUFMLENBQVcsUUFBWCxDQUFvQixPQUFwQixDQUE0QixVQUFDLEdBQUQsRUFBUztBQUNwQyxvQkFBWSxJQUFaLENBQWlCLG9CQUFDLFVBQUQsSUFBWSxhQUFhLEdBQXpCLEdBQWpCO0FBQ0EsT0FGRDs7QUFJQSxhQUNBO0FBQUE7QUFBQSxVQUFLLFdBQVUsV0FBZjtBQUNFO0FBQUE7QUFBQSxZQUFLLElBQUcsVUFBUjtBQUNFO0FBREYsU0FERjtBQUlFLDRCQUFDLFdBQUQsSUFBYSxZQUFZLEtBQUssVUFBOUIsR0FKRjtBQUtFLDRCQUFDLGVBQUQsSUFBaUIsVUFBVSxLQUFLLEtBQUwsQ0FBVyxZQUF0QztBQUxGLE9BREE7QUFTQTs7OztFQTdFdUIsTUFBTSxTOztBQThFL0I7O0FBRUQsU0FBUyxNQUFULENBQWdCLG9CQUFDLFdBQUQsT0FBaEIsRUFBaUMsU0FBUyxhQUFULENBQXVCLGVBQXZCLENBQWpDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxyXG5jbGFzcyBVc2VyTGlzdERpc3BsYXkgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgXHR2YXIgdXNlclJvd3MgPSBbXSxcclxuICBcdFx0XHRjdXJVc2VyID0gdGhpcy5wcm9wcy51c2VyRGF0YS5jdXJVc2VyTmFtZTtcclxuXHJcbiAgXHR2YXIgdXNlcnMgPSB0aGlzLnByb3BzLnVzZXJEYXRhLmxpc3QuZmlsdGVyKGZ1bmN0aW9uKHVzZXIpIHsgcmV0dXJuIHVzZXIgIT09IGN1clVzZXI7IH0pXHJcbiAgXHR1c2Vycy5mb3JFYWNoKCh1c2VyKSA9PiB7XHJcbiAgXHRcdHVzZXJSb3dzLnB1c2goPGxpPnt1c2VyfTwvbGk+KTtcclxuICBcdH0pO1xyXG4gIFx0cmV0dXJuIChcclxuICBcdFx0PGRpdiBjbGFzc05hbWU9XCJ1c2VyLWxpc3QtaW5mb1wiPlxyXG4gIFx0XHRcdHsgdGhpcy5wcm9wcy51c2VyRGF0YS5saXN0Lmxlbmd0aCA+IDAgJiZcclxuICBcdFx0XHQ8ZGl2PlxyXG4gIFx0XHRcdFx0PHA+V2VsY29tZSB7dGhpcy5wcm9wcy51c2VyRGF0YS5jdXJVc2VyTmFtZX08L3A+XHJcbiAgXHRcdFx0XHQ8cD5PdGhlciBVc2VycyBPbmxpbmUgKHt1c2Vycy5sZW5ndGh9IG9ubGluZSk8L3A+XHJcbiAgXHRcdFx0PC9kaXY+XHJcbiAgXHRcdFx0fVxyXG4gIFx0XHRcdDx1bD5cclxuICBcdFx0XHRcdHt1c2VyUm93c31cclxuICBcdFx0XHQ8L3VsPlxyXG4gIFx0XHQ8L2Rpdj5cclxuICBcdCk7XHJcbiAgfVxyXG59O1xyXG5cclxuXHJcbmNsYXNzIE1lc3NhZ2VSb3cgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgXHR2YXIgbXNnID0gdGhpcy5wcm9wcy5tZXNzYWdlRGF0YTtcclxuICBcdHZhciBkaXZDbGFzc2VzID0gbXNnLmlzTWUgPyAncm93IG1lc3NhZ2Ugc2VsZicgOiAncm93IG1lc3NhZ2UnO1xyXG4gIFx0cmV0dXJuIChcclxuICBcdFx0PGRpdiBjbGFzc05hbWU9e2RpdkNsYXNzZXN9PlxyXG4gIFx0XHRcdDxwIGNsYXNzTmFtZT1cIm1lc3NhZ2UtaW5mb1wiPlxyXG4gIFx0XHRcdFx0PHNwYW4gY2xhc3NOYW1lPVwidXNlclwiPnttc2cubmFtZX0sIDwvc3Bhbj5cclxuICBcdFx0XHRcdDx0aW1lIGNsYXNzTmFtZT1cImRhdGVcIiB0aXRsZT17bXNnLmRhdGV9Pnttc2cuZGF0ZX08L3RpbWU+XHJcbiAgXHRcdFx0PC9wPlxyXG4gIFx0XHRcdDxwIGNsYXNzTmFtZT1cIm1lc3NhZ2UtdGV4dFwiPnttc2cubWVzc2FnZX08L3A+XHJcbiAgXHRcdDwvZGl2PlxyXG4gIFx0KTtcclxuICB9XHJcbn07XHJcblxyXG5cclxuY2xhc3MgTWVzc2FnZUZvcm0gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcblxyXG4gICAgdGhpcy5oYW5kbGVDaGFuZ2UgPSB0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5oYW5kbGVTdWJtaXQgPSB0aGlzLmhhbmRsZVN1Ym1pdC5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICBcdG1lc3NhZ2U6ICcnXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDaGFuZ2UoZSkge1xyXG4gICAgbGV0IG5ld1N0YXRlID0ge307XHJcbiAgICBuZXdTdGF0ZVtlLnRhcmdldC5uYW1lXSA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShuZXdTdGF0ZSk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTdWJtaXQoZSkge1xyXG4gIFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBcdHZhciBzZWxmID0gdGhpcztcclxuICBcdGFwcC5zZW5kTWVzc2FnZSh0aGlzLnN0YXRlLm1lc3NhZ2UsIGZ1bmN0aW9uKHN1Y2Nlc3MpIHtcclxuICBcdFx0aWYgKHN1Y2Nlc3MpIHtcclxuICBcdFx0XHRzZWxmLnByb3BzLmFkZE1lc3NhZ2Uoe1xyXG4gIFx0XHRcdFx0bWVzc2FnZTogc2VsZi5zdGF0ZS5tZXNzYWdlLFxyXG4gIFx0XHRcdFx0bmFtZTogJ01lJyxcclxuICBcdFx0XHRcdGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICBcdFx0XHRcdGlzTWU6IHRydWVcclxuICBcdFx0XHR9KTtcclxuICBcdFx0XHRzZWxmLnNldFN0YXRlKHsgbWVzc2FnZTogJycgfSk7XHJcbiAgXHRcdH1cclxuICBcdH0pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gIFx0cmV0dXJuIChcclxuICBcdFx0PGRpdiBjbGFzc05hbWU9XCJtZXNzYWdlLWZvcm0tZGl2XCI+XHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3RoaXMuaGFuZGxlU3VibWl0fSBub3ZhbGlkYXRlPlxyXG4gICAgICAgIFx0PGRpdiBjbGFzc05hbWU9XCJpbnB1dC1ncm91cFwiPlxyXG4gICAgICAgICAgICA8aW5wdXQgbmFtZT1cIm1lc3NhZ2VcIiB0eXBlPVwidGV4dFwiIGNsYXNzTmFtZT1cImZvcm0tY29udHJvbFwiXHJcblx0XHRcdFx0XHRcdFx0cGxhY2Vob2xkZXI9XCJFbnRlciBhIG1lc3NhZ2VcIlxyXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX0gdmFsdWU9e3RoaXMuc3RhdGUubWVzc2FnZX1cclxuICAgICAgICAgICAgXHR2YWx1ZT17dGhpcy5zdGF0ZS5tZXNzYWdlfSAvPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJpbnB1dC1ncm91cC1idG5cIj5cclxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tc3VjY2Vzc1wiIHR5cGU9XCJzdWJtaXRcIiBkaXNhYmxlZD17IXRoaXMuc3RhdGUubWVzc2FnZX0+U2VuZDwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgXHQ8L2Rpdj5cclxuICAgICAgICA8L2Zvcm0+XHJcbiAgXHRcdDwvZGl2PlxyXG4gIFx0KTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENoYXRTZWN0aW9uIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG5cclxuICAgIHRoaXMuYWRkTWVzc2FnZSA9IHRoaXMuYWRkTWVzc2FnZS5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICBcdG1lc3NhZ2VzOiBbXSxcclxuICAgIFx0dXNlckxpc3REYXRhOiB7XHJcbiAgICBcdFx0Y3VyVXNlck5hbWU6ICcnLCAvLyBOYW1lIG9mIHRoaXMgY3VycmVudCB1c2VyXHJcbiAgICBcdFx0bGlzdDogW11cclxuICAgIFx0fVxyXG4gICAgfTtcclxuXHJcbiAgfVxyXG5cclxuICAvLyBTdWJzY3JpYmUgZm9yIHB1YnN1YiBmcm9tIG1haW4gYXBwLiBFeHRlcm5hbCBtZXNzYWdlcyBhcmUgc3Vic2NyaWJlZCB0byBoZXJlXHJcbiAgLy8gUHVic3ViIHcvIHJlYWN0IGFuZCBwdWJzdWItanNcclxuICAvLyAgIFNlZTogaHR0cHM6Ly9hbnRob255bWluZW8uY29tL2NvbW11bmljYXRpb24tYmV0d2Vlbi1pbmRlcGVuZGVudC1jb21wb25lbnRzLWluLXJlYWN0LXVzaW5nLXB1YnN1YmpzL1xyXG5cdGNvbXBvbmVudFdpbGxNb3VudCgpIHtcclxuXHRcdHRoaXMubWVzc2FnZVRva2VuID0gUHViU3ViLnN1YnNjcmliZSgnTmV3TWVzc2FnZScsIHRoaXMuZXh0ZXJuYWxNZXNzYWdlLmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy51c2VyRGF0YVRva2UgPSBQdWJTdWIuc3Vic2NyaWJlKCdVc2VyTGlzdERhdGEnLCB0aGlzLnVzZXJEYXRhVXBkYXRlLmJpbmQodGhpcykpO1xyXG5cdH1cclxuXHQvL2NvbXBvbmVudERpZE1vdW50KCkge31cclxuXHRjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuXHRcdFB1YlN1Yi51bnN1YnNjcmliZSh0aGlzLm1lc3NhZ2VUb2tlbik7XHJcblx0fVxyXG5cdGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcclxuXHRcdC8vIFdpcmUgdXAganF1ZXJ5LnRpbWVhZ28gcGx1Z2luIHRvIGNoYXQgdGltZXN0YW1wcyBhZnRlciByZW5kZXJcclxuICAgICQoJ3RpbWUnKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAkKHRoaXMpLnRleHQoJC50aW1lYWdvKCQodGhpcykuYXR0cigndGl0bGUnKSkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gUHVibGlzaCBhIG1lc3NhZ2UgdGhhdCB0aGUgY2hhdCBib3ggaGFzIGJlZW4gcmVuZGVyZWRcclxuICAgIFB1YlN1Yi5wdWJsaXNoKCdDaGF0Qm94UmVuZGVyZWQnLCB7fSk7XHJcblx0fVxyXG5cclxuXHQvLyBFeHRlcm5hbCBtZXNzYWdlcyByZWNpZXZlZCBoZXJlXHJcblx0ZXh0ZXJuYWxNZXNzYWdlKG1zZywgZGF0YSkge1xyXG5cdFx0Y29uc29sZS5sb2coJ3B1YnN1Yi0+ICcrIG1zZyArIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuXHRcdHRoaXMuYWRkTWVzc2FnZShkYXRhKTtcclxuXHR9XHJcblxyXG5cdC8vIEV4dGVybmFsIHB1YnN1YiB1c2VyIGRhdGEgdXBkYXRlIHJlY2lldmVkIGhlcmVcclxuXHR1c2VyRGF0YVVwZGF0ZShtc2csIGRhdGEpIHtcclxuXHRcdGNvbnNvbGUubG9nKCdwdWJzdWItPiAnKyBtc2cgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcblx0XHR0aGlzLnNldFN0YXRlKHtcclxuXHRcdFx0dXNlckxpc3REYXRhOiB7XHJcblx0XHRcdFx0Y3VyVXNlck5hbWU6IGRhdGEuY3VyVXNlck5hbWUsXHJcblx0XHRcdFx0bGlzdDogZGF0YS5saXN0XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcbiAgYWRkTWVzc2FnZShkYXRhKSB7XHJcbiAgXHR2YXIgbmV3TWVzc2FnZXMgPSB0aGlzLnN0YXRlLm1lc3NhZ2VzLm1hcChmdW5jdGlvbihtc2cpIHsgcmV0dXJuIG1zZzsgfSk7XHJcbiAgXHRuZXdNZXNzYWdlcy5wdXNoKGRhdGEpO1xyXG4gIFx0dGhpcy5zZXRTdGF0ZSh7bWVzc2FnZXM6IG5ld01lc3NhZ2VzfSk7XHJcbiAgXHRjb25zb2xlLmxvZygnYWRkTWVzc2FnZScpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG5cclxuICBcdHZhciBtZXNzYWdlUm93cyA9IFtdO1xyXG4gIFx0dGhpcy5zdGF0ZS5tZXNzYWdlcy5mb3JFYWNoKChtc2cpID0+IHtcclxuICBcdFx0bWVzc2FnZVJvd3MucHVzaCg8TWVzc2FnZVJvdyBtZXNzYWdlRGF0YT17bXNnfSAvPik7XHJcbiAgXHR9KTtcclxuXHJcbiAgXHRyZXR1cm4gKFxyXG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cImNvbC1sZy0xMlwiPlxyXG4gIFx0XHRcdDxkaXYgaWQ9XCJjaGF0LWJveFwiPlxyXG4gIFx0XHRcdFx0e21lc3NhZ2VSb3dzfVxyXG4gIFx0XHRcdDwvZGl2PlxyXG4gIFx0XHRcdDxNZXNzYWdlRm9ybSBhZGRNZXNzYWdlPXt0aGlzLmFkZE1lc3NhZ2V9IC8+XHJcbiAgXHRcdFx0PFVzZXJMaXN0RGlzcGxheSB1c2VyRGF0YT17dGhpcy5zdGF0ZS51c2VyTGlzdERhdGF9IC8+XHJcbiAgXHRcdDwvZGl2PlxyXG4gIFx0KTtcclxuICB9XHJcbn07XHJcblxyXG5SZWFjdERPTS5yZW5kZXIoPENoYXRTZWN0aW9uIC8+LCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2hhdC1zZWN0aW9uJykpO1xyXG4iXX0=
