(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var UserListDisplay = function (_React$Component) {
  _inherits(UserListDisplay, _React$Component);

  function UserListDisplay(props) {
    _classCallCheck(this, UserListDisplay);

    return _possibleConstructorReturn(this, (UserListDisplay.__proto__ || Object.getPrototypeOf(UserListDisplay)).call(this, props));
  }

  _createClass(UserListDisplay, [{
    key: 'render',
    value: function render() {
      var userRows = [],
          curUser = this.props.userData.curUserName;

      var users = this.props.userData.list.filter(function (user) {
        return user !== curUser;
      });
      users.forEach(function (user) {
        userRows.push(React.createElement(
          'li',
          null,
          user
        ));
      });
      return React.createElement(
        'div',
        { className: 'user-list-info' },
        this.props.userData.list.length > 0 && React.createElement(
          'div',
          null,
          React.createElement(
            'p',
            null,
            'Welcome ',
            this.props.userData.curUserName
          ),
          React.createElement(
            'p',
            null,
            'Other Users Online (',
            users.length,
            ' online)'
          )
        ),
        React.createElement(
          'ul',
          null,
          userRows
        )
      );
    }
  }]);

  return UserListDisplay;
}(React.Component);

;

var MessageRow = function (_React$Component2) {
  _inherits(MessageRow, _React$Component2);

  function MessageRow(props) {
    _classCallCheck(this, MessageRow);

    return _possibleConstructorReturn(this, (MessageRow.__proto__ || Object.getPrototypeOf(MessageRow)).call(this, props));
  }

  _createClass(MessageRow, [{
    key: 'render',
    value: function render() {
      var msg = this.props.messageData;
      var divClasses = msg.isMe ? 'row message self' : 'row message';
      return React.createElement(
        'div',
        { className: divClasses },
        React.createElement(
          'p',
          { className: 'message-info' },
          React.createElement(
            'span',
            { className: 'user' },
            msg.name,
            ', '
          ),
          React.createElement(
            'time',
            { className: 'date', title: msg.date },
            msg.date
          )
        ),
        React.createElement(
          'p',
          { className: 'message-text' },
          msg.message
        )
      );
    }
  }]);

  return MessageRow;
}(React.Component);

;

var MessageForm = function (_React$Component3) {
  _inherits(MessageForm, _React$Component3);

  function MessageForm(props) {
    _classCallCheck(this, MessageForm);

    var _this3 = _possibleConstructorReturn(this, (MessageForm.__proto__ || Object.getPrototypeOf(MessageForm)).call(this, props));

    _this3.handleChange = _this3.handleChange.bind(_this3);
    _this3.handleSubmit = _this3.handleSubmit.bind(_this3);

    _this3.state = {
      message: ''
    };
    return _this3;
  }

  _createClass(MessageForm, [{
    key: 'handleChange',
    value: function handleChange(e) {
      var newState = {};
      newState[e.target.name] = e.target.value;
      this.setState(newState);
    }
  }, {
    key: 'handleSubmit',
    value: function handleSubmit(e) {
      e.preventDefault();

      var self = this;
      app.sendMessage(this.state.message, function (success) {
        if (success) {
          self.props.addMessage({
            message: self.state.message,
            name: 'Me',
            date: new Date().toISOString(),
            isMe: true
          });
          self.setState({ message: '' });
        }
      });
    }
  }, {
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'message-form-div' },
        React.createElement(
          'form',
          { onSubmit: this.handleSubmit, novalidate: true },
          React.createElement(
            'div',
            { className: 'input-group' },
            React.createElement('input', _defineProperty({ name: 'message', type: 'text', className: 'form-control',
              placeholder: 'Enter a message',
              onChange: this.handleChange, value: this.state.message
            }, 'value', this.state.message)),
            React.createElement(
              'span',
              { className: 'input-group-btn' },
              React.createElement(
                'button',
                { className: 'btn btn-success', type: 'submit', disabled: !this.state.message },
                'Send'
              )
            )
          )
        )
      );
    }
  }]);

  return MessageForm;
}(React.Component);

var ChatSection = function (_React$Component4) {
  _inherits(ChatSection, _React$Component4);

  function ChatSection(props) {
    _classCallCheck(this, ChatSection);

    var _this4 = _possibleConstructorReturn(this, (ChatSection.__proto__ || Object.getPrototypeOf(ChatSection)).call(this, props));

    _this4.addMessage = _this4.addMessage.bind(_this4);

    _this4.state = {
      messages: [],
      userListData: {
        curUserName: '', // Name of this current user
        list: []
      }
    };

    return _this4;
  }

  // Subscribe for pubsub from main app. External messages are subscribed to here
  // Pubsub w/ react and pubsub-js
  //   See: https://anthonymineo.com/communication-between-independent-components-in-react-using-pubsubjs/


  _createClass(ChatSection, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      this.messageToken = PubSub.subscribe('NewMessage', this.externalMessage.bind(this));
      this.userDataToke = PubSub.subscribe('UserListData', this.userDataUpdate.bind(this));
    }
    //componentDidMount() {}

  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      PubSub.unsubscribe(this.messageToken);
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      // Wire up jquery.timeago plugin to chat timestamps after render
      app.timeAgo();

      // Publish a message that the chat box has been rendered
      PubSub.publish('ChatBoxRendered', {});
    }

    // External messages recieved here

  }, {
    key: 'externalMessage',
    value: function externalMessage(msg, data) {
      this.addMessage(data);
    }

    // External pubsub user data update recieved here

  }, {
    key: 'userDataUpdate',
    value: function userDataUpdate(msg, data) {
      this.setState({
        userListData: {
          curUserName: data.curUserName,
          list: data.list
        }
      });
    }
  }, {
    key: 'addMessage',
    value: function addMessage(data) {
      var newMessages = this.state.messages.map(function (msg) {
        return msg;
      });
      newMessages.push(data);
      this.setState({ messages: newMessages });
    }
  }, {
    key: 'render',
    value: function render() {

      var messageRows = [];
      this.state.messages.forEach(function (msg) {
        messageRows.push(React.createElement(MessageRow, { messageData: msg }));
      });

      return React.createElement(
        'div',
        { className: 'col-lg-12' },
        React.createElement(
          'div',
          { id: 'chat-box' },
          messageRows
        ),
        React.createElement(MessageForm, { addMessage: this.addMessage }),
        React.createElement(UserListDisplay, { userData: this.state.userListData })
      );
    }
  }]);

  return ChatSection;
}(React.Component);

;

ReactDOM.render(React.createElement(ChatSection, null), document.querySelector('#chat-section'));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjbGllbnRcXGpzeFxcY2hhdC1zZWN0aW9uLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztJQ0FNLGU7OztBQUNKLDJCQUFZLEtBQVosRUFBbUI7QUFBQTs7QUFBQSw2SEFDWCxLQURXO0FBRWxCOzs7OzZCQUVRO0FBQ1IsVUFBSSxXQUFXLEVBQWY7QUFBQSxVQUNFLFVBQVUsS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFvQixXQURoQzs7QUFHQSxVQUFJLFFBQVEsS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFvQixJQUFwQixDQUF5QixNQUF6QixDQUFnQyxVQUFTLElBQVQsRUFBZTtBQUFFLGVBQU8sU0FBUyxPQUFoQjtBQUEwQixPQUEzRSxDQUFaO0FBQ0EsWUFBTSxPQUFOLENBQWMsVUFBQyxJQUFELEVBQVU7QUFDdkIsaUJBQVMsSUFBVCxDQUFjO0FBQUE7QUFBQTtBQUFLO0FBQUwsU0FBZDtBQUNBLE9BRkQ7QUFHQSxhQUNDO0FBQUE7QUFBQSxVQUFLLFdBQVUsZ0JBQWY7QUFDRyxhQUFLLEtBQUwsQ0FBVyxRQUFYLENBQW9CLElBQXBCLENBQXlCLE1BQXpCLEdBQWtDLENBQWxDLElBQ0Y7QUFBQTtBQUFBO0FBQ0M7QUFBQTtBQUFBO0FBQUE7QUFBWSxpQkFBSyxLQUFMLENBQVcsUUFBWCxDQUFvQjtBQUFoQyxXQUREO0FBRUM7QUFBQTtBQUFBO0FBQUE7QUFBd0Isa0JBQU0sTUFBOUI7QUFBQTtBQUFBO0FBRkQsU0FGRDtBQU9DO0FBQUE7QUFBQTtBQUNFO0FBREY7QUFQRCxPQUREO0FBYUE7Ozs7RUExQjJCLE1BQU0sUzs7QUEyQm5DOztJQUdLLFU7OztBQUNKLHNCQUFZLEtBQVosRUFBbUI7QUFBQTs7QUFBQSxtSEFDWCxLQURXO0FBRWxCOzs7OzZCQUVRO0FBQ1IsVUFBSSxNQUFNLEtBQUssS0FBTCxDQUFXLFdBQXJCO0FBQ0EsVUFBSSxhQUFh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LEtBQUssS0FBTCxDQUFXLFlBQXRDO0FBTEYsT0FEQTtBQVNBOzs7O0VBeEV1QixNQUFNLFM7O0FBeUUvQjs7QUFFRCxTQUFTLE1BQVQsQ0FBZ0Isb0JBQUMsV0FBRCxPQUFoQixFQUFpQyxTQUFTLGFBQVQsQ0FBdUIsZUFBdkIsQ0FBakMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY2xhc3MgVXNlckxpc3REaXNwbGF5IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gIFx0dmFyIHVzZXJSb3dzID0gW10sXHJcbiAgXHRcdFx0Y3VyVXNlciA9IHRoaXMucHJvcHMudXNlckRhdGEuY3VyVXNlck5hbWU7XHJcblxyXG4gIFx0dmFyIHVzZXJzID0gdGhpcy5wcm9wcy51c2VyRGF0YS5saXN0LmZpbHRlcihmdW5jdGlvbih1c2VyKSB7IHJldHVybiB1c2VyICE9PSBjdXJVc2VyOyB9KVxyXG4gIFx0dXNlcnMuZm9yRWFjaCgodXNlcikgPT4ge1xyXG4gIFx0XHR1c2VyUm93cy5wdXNoKDxsaT57dXNlcn08L2xpPik7XHJcbiAgXHR9KTtcclxuICBcdHJldHVybiAoXHJcbiAgXHRcdDxkaXYgY2xhc3NOYW1lPVwidXNlci1saXN0LWluZm9cIj5cclxuICBcdFx0XHR7IHRoaXMucHJvcHMudXNlckRhdGEubGlzdC5sZW5ndGggPiAwICYmXHJcbiAgXHRcdFx0PGRpdj5cclxuICBcdFx0XHRcdDxwPldlbGNvbWUge3RoaXMucHJvcHMudXNlckRhdGEuY3VyVXNlck5hbWV9PC9wPlxyXG4gIFx0XHRcdFx0PHA+T3RoZXIgVXNlcnMgT25saW5lICh7dXNlcnMubGVuZ3RofSBvbmxpbmUpPC9wPlxyXG4gIFx0XHRcdDwvZGl2PlxyXG4gIFx0XHRcdH1cclxuICBcdFx0XHQ8dWw+XHJcbiAgXHRcdFx0XHR7dXNlclJvd3N9XHJcbiAgXHRcdFx0PC91bD5cclxuICBcdFx0PC9kaXY+XHJcbiAgXHQpO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG5jbGFzcyBNZXNzYWdlUm93IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gIFx0dmFyIG1zZyA9IHRoaXMucHJvcHMubWVzc2FnZURhdGE7XHJcbiAgXHR2YXIgZGl2Q2xhc3NlcyA9IG1zZy5pc01lID8gJ3JvdyBtZXNzYWdlIHNlbGYnIDogJ3JvdyBtZXNzYWdlJztcclxuICBcdHJldHVybiAoXHJcbiAgXHRcdDxkaXYgY2xhc3NOYW1lPXtkaXZDbGFzc2VzfT5cclxuICBcdFx0XHQ8cCBjbGFzc05hbWU9XCJtZXNzYWdlLWluZm9cIj5cclxuICBcdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT1cInVzZXJcIj57bXNnLm5hbWV9LCA8L3NwYW4+XHJcbiAgXHRcdFx0XHQ8dGltZSBjbGFzc05hbWU9XCJkYXRlXCIgdGl0bGU9e21zZy5kYXRlfT57bXNnLmRhdGV9PC90aW1lPlxyXG4gIFx0XHRcdDwvcD5cclxuICBcdFx0XHQ8cCBjbGFzc05hbWU9XCJtZXNzYWdlLXRleHRcIj57bXNnLm1lc3NhZ2V9PC9wPlxyXG4gIFx0XHQ8L2Rpdj5cclxuICBcdCk7XHJcbiAgfVxyXG59O1xyXG5cclxuXHJcbmNsYXNzIE1lc3NhZ2VGb3JtIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG5cclxuICAgIHRoaXMuaGFuZGxlQ2hhbmdlID0gdGhpcy5oYW5kbGVDaGFuZ2UuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuaGFuZGxlU3VibWl0ID0gdGhpcy5oYW5kbGVTdWJtaXQuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgXHRtZXNzYWdlOiAnJ1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlQ2hhbmdlKGUpIHtcclxuICAgIGxldCBuZXdTdGF0ZSA9IHt9O1xyXG4gICAgbmV3U3RhdGVbZS50YXJnZXQubmFtZV0gPSBlLnRhcmdldC52YWx1ZTtcclxuICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0KGUpIHtcclxuICBcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgXHR2YXIgc2VsZiA9IHRoaXM7XHJcbiAgXHRhcHAuc2VuZE1lc3NhZ2UodGhpcy5zdGF0ZS5tZXNzYWdlLCBmdW5jdGlvbihzdWNjZXNzKSB7XHJcbiAgXHRcdGlmIChzdWNjZXNzKSB7XHJcbiAgXHRcdFx0c2VsZi5wcm9wcy5hZGRNZXNzYWdlKHtcclxuICBcdFx0XHRcdG1lc3NhZ2U6IHNlbGYuc3RhdGUubWVzc2FnZSxcclxuICBcdFx0XHRcdG5hbWU6ICdNZScsXHJcbiAgXHRcdFx0XHRkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgXHRcdFx0XHRpc01lOiB0cnVlXHJcbiAgXHRcdFx0fSk7XHJcbiAgXHRcdFx0c2VsZi5zZXRTdGF0ZSh7IG1lc3NhZ2U6ICcnIH0pO1xyXG4gIFx0XHR9XHJcbiAgXHR9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICBcdHJldHVybiAoXHJcbiAgXHRcdDxkaXYgY2xhc3NOYW1lPVwibWVzc2FnZS1mb3JtLWRpdlwiPlxyXG4gICAgICAgIDxmb3JtIG9uU3VibWl0PXt0aGlzLmhhbmRsZVN1Ym1pdH0gbm92YWxpZGF0ZT5cclxuICAgICAgICBcdDxkaXYgY2xhc3NOYW1lPVwiaW5wdXQtZ3JvdXBcIj5cclxuICAgICAgICAgICAgPGlucHV0IG5hbWU9XCJtZXNzYWdlXCIgdHlwZT1cInRleHRcIiBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIlxyXG5cdFx0XHRcdFx0XHRcdHBsYWNlaG9sZGVyPVwiRW50ZXIgYSBtZXNzYWdlXCJcclxuICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9IHZhbHVlPXt0aGlzLnN0YXRlLm1lc3NhZ2V9XHJcbiAgICAgICAgICAgIFx0dmFsdWU9e3RoaXMuc3RhdGUubWVzc2FnZX0gLz5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaW5wdXQtZ3JvdXAtYnRuXCI+XHJcbiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLXN1Y2Nlc3NcIiB0eXBlPVwic3VibWl0XCIgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLm1lc3NhZ2V9PlNlbmQ8L2J1dHRvbj5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIFx0PC9kaXY+XHJcbiAgICAgICAgPC9mb3JtPlxyXG4gIFx0XHQ8L2Rpdj5cclxuICBcdCk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBDaGF0U2VjdGlvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcclxuICAgIHN1cGVyKHByb3BzKTtcclxuXHJcbiAgICB0aGlzLmFkZE1lc3NhZ2UgPSB0aGlzLmFkZE1lc3NhZ2UuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgXHRtZXNzYWdlczogW10sXHJcbiAgICBcdHVzZXJMaXN0RGF0YToge1xyXG4gICAgXHRcdGN1clVzZXJOYW1lOiAnJywgLy8gTmFtZSBvZiB0aGlzIGN1cnJlbnQgdXNlclxyXG4gICAgXHRcdGxpc3Q6IFtdXHJcbiAgICBcdH1cclxuICAgIH07XHJcblxyXG4gIH1cclxuXHJcbiAgLy8gU3Vic2NyaWJlIGZvciBwdWJzdWIgZnJvbSBtYWluIGFwcC4gRXh0ZXJuYWwgbWVzc2FnZXMgYXJlIHN1YnNjcmliZWQgdG8gaGVyZVxyXG4gIC8vIFB1YnN1YiB3LyByZWFjdCBhbmQgcHVic3ViLWpzXHJcbiAgLy8gICBTZWU6IGh0dHBzOi8vYW50aG9ueW1pbmVvLmNvbS9jb21tdW5pY2F0aW9uLWJldHdlZW4taW5kZXBlbmRlbnQtY29tcG9uZW50cy1pbi1yZWFjdC11c2luZy1wdWJzdWJqcy9cclxuXHRjb21wb25lbnRXaWxsTW91bnQoKSB7XHJcblx0XHR0aGlzLm1lc3NhZ2VUb2tlbiA9IFB1YlN1Yi5zdWJzY3JpYmUoJ05ld01lc3NhZ2UnLCB0aGlzLmV4dGVybmFsTWVzc2FnZS5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMudXNlckRhdGFUb2tlID0gUHViU3ViLnN1YnNjcmliZSgnVXNlckxpc3REYXRhJywgdGhpcy51c2VyRGF0YVVwZGF0ZS5iaW5kKHRoaXMpKTtcclxuXHR9XHJcblx0Ly9jb21wb25lbnREaWRNb3VudCgpIHt9XHJcblx0Y29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcblx0XHRQdWJTdWIudW5zdWJzY3JpYmUodGhpcy5tZXNzYWdlVG9rZW4pO1xyXG5cdH1cclxuXHRjb21wb25lbnREaWRVcGRhdGUoKSB7XHJcblx0XHQvLyBXaXJlIHVwIGpxdWVyeS50aW1lYWdvIHBsdWdpbiB0byBjaGF0IHRpbWVzdGFtcHMgYWZ0ZXIgcmVuZGVyXHJcblx0XHRhcHAudGltZUFnbygpO1xyXG5cclxuICAgIC8vIFB1Ymxpc2ggYSBtZXNzYWdlIHRoYXQgdGhlIGNoYXQgYm94IGhhcyBiZWVuIHJlbmRlcmVkXHJcbiAgICBQdWJTdWIucHVibGlzaCgnQ2hhdEJveFJlbmRlcmVkJywge30pO1xyXG5cdH1cclxuXHJcblx0Ly8gRXh0ZXJuYWwgbWVzc2FnZXMgcmVjaWV2ZWQgaGVyZVxyXG5cdGV4dGVybmFsTWVzc2FnZShtc2csIGRhdGEpIHtcclxuXHRcdHRoaXMuYWRkTWVzc2FnZShkYXRhKTtcclxuXHR9XHJcblxyXG5cdC8vIEV4dGVybmFsIHB1YnN1YiB1c2VyIGRhdGEgdXBkYXRlIHJlY2lldmVkIGhlcmVcclxuXHR1c2VyRGF0YVVwZGF0ZShtc2csIGRhdGEpIHtcclxuXHRcdHRoaXMuc2V0U3RhdGUoe1xyXG5cdFx0XHR1c2VyTGlzdERhdGE6IHtcclxuXHRcdFx0XHRjdXJVc2VyTmFtZTogZGF0YS5jdXJVc2VyTmFtZSxcclxuXHRcdFx0XHRsaXN0OiBkYXRhLmxpc3RcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuICBhZGRNZXNzYWdlKGRhdGEpIHtcclxuICBcdHZhciBuZXdNZXNzYWdlcyA9IHRoaXMuc3RhdGUubWVzc2FnZXMubWFwKGZ1bmN0aW9uKG1zZykgeyByZXR1cm4gbXNnOyB9KTtcclxuICBcdG5ld01lc3NhZ2VzLnB1c2goZGF0YSk7XHJcbiAgXHR0aGlzLnNldFN0YXRlKHttZXNzYWdlczogbmV3TWVzc2FnZXN9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlcigpIHtcclxuXHJcbiAgXHR2YXIgbWVzc2FnZVJvd3MgPSBbXTtcclxuICBcdHRoaXMuc3RhdGUubWVzc2FnZXMuZm9yRWFjaCgobXNnKSA9PiB7XHJcbiAgXHRcdG1lc3NhZ2VSb3dzLnB1c2goPE1lc3NhZ2VSb3cgbWVzc2FnZURhdGE9e21zZ30gLz4pO1xyXG4gIFx0fSk7XHJcblxyXG4gIFx0cmV0dXJuIChcclxuXHRcdFx0PGRpdiBjbGFzc05hbWU9XCJjb2wtbGctMTJcIj5cclxuICBcdFx0XHQ8ZGl2IGlkPVwiY2hhdC1ib3hcIj5cclxuICBcdFx0XHRcdHttZXNzYWdlUm93c31cclxuICBcdFx0XHQ8L2Rpdj5cclxuICBcdFx0XHQ8TWVzc2FnZUZvcm0gYWRkTWVzc2FnZT17dGhpcy5hZGRNZXNzYWdlfSAvPlxyXG4gIFx0XHRcdDxVc2VyTGlzdERpc3BsYXkgdXNlckRhdGE9e3RoaXMuc3RhdGUudXNlckxpc3REYXRhfSAvPlxyXG4gIFx0XHQ8L2Rpdj5cclxuICBcdCk7XHJcbiAgfVxyXG59O1xyXG5cclxuUmVhY3RET00ucmVuZGVyKDxDaGF0U2VjdGlvbiAvPiwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NoYXQtc2VjdGlvbicpKTtcclxuIl19
